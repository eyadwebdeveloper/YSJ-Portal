<!DOCTYPE html>
<html lang="en">

<head>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="portal_style.css">
    <meta name="theme-color" content="#c32636">

    <link rel="shortcut icon" type="image/x-icon" href="images/Logo.png" />

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

    <title>Almost Done | YSJ Portal</title>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <!-- Add additional services that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  </head>
</head>

<body>
  <div class="content">
    <div class="wrapper portal">
      <h1><a href="https://www.ys-journal.org" target="_blank"><img class="logo" src="images/Logo.png" alt=""></a>
        Application Portal</h1>
      <form action="/submit" method="post" id="finishForm">
        <h2>Thanks for reaching here!</h2>
        <hr>
        <label for="gender">How did this portal reach you?<span>*</span></label>
        <select id="list gender" onchange="getSelectValue()" ;>
          <option value="way">Telegram Group/Channel</option>
          <option value="way">Whatsapp/Discord Group</option>
          <option value="way">Facebook page (Follower)</option>
          <option value="way">Facebook AD</option>
          <option value="way">Direct contact with YSJ staff</option>
          <option value="way">RoundPier</option>
          <option value="way">LinkedIn</option>
          <option value="way">Instagram page</option>
          <option value="way">Ambassador</option>
          <option value="way">School Counselor</option>
          <option value="way">Personal Connections (e.g., Friends and/or Teachers)</option>
          <option value="way">Search Engines (e.g., Google)</option>
          <option value="way">WhatsApp Groups</option>
          <option value="way">Other</option>
          <input type="text" placeholder="if you have selected 'Other' type here">
          <input type="text" placeholder="if you have selected 'Ambassador' please type the ambassador referal code">


        </select>
        <label for="con">Feel free to add whatever you feel may boost your application even
          further.<span>*</span></label>
        <textarea name="con" onkeyup="textAreaAdjust(this)"></textarea required>

                <div class="btnss">
                  <a href="avaliable.html" class="switch pree" style="height: 20px;margin-top: 20px;">Previous</a>
                <button type="submit" id="submit" class="Btn"></button>
            </div>
            </form>
        </div>
        <a href="https://www.ys-journal.org" target="_blank" class="fixed">
            <i class="fa-solid fa-house"></i>
          </a>
    </div>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "firebase/app";
      import { getAnalytics } from "firebase/analytics";
      import 'firebase/firestore';
      import 'firebase/auth';

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDQtBb8zDA1iPZBRjFtXjcnj2zAIhlHzIY",
        authDomain: "ysg-portal.firebaseapp.com",
        projectId: "ysg-portal",
        storageBucket: "ysg-portal.appspot.com",
        messagingSenderId: "91821075370",
        appId: "1:91821075370:web:80369759cd25604e7499d3",
        measurementId: "G-EC8037VVTR"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>
    <script>
      function saveFormData() {
        let selectedOption = document.getElementById("reach").value;
        let otherText = document.getElementById("otherText").value;
        let ambassadorCode = document.getElementById("ambassadorCode").value;
        let additionalInfo = document.getElementById("boost").value;

        let formData = {
          selectedOption: selectedOption,
          otherText: otherText,
          ambassadorCode: ambassadorCode,
          additionalInfo: additionalInfo
        };

        localStorage.setItem("finishFormData", JSON.stringify(formData));
      }

      // Function to render and append form data to the spreadsheet
      // Function to save form data to Firestore
      // Function to render and append form data to the spreadsheet
      function renderAndAppendData() {
        // Retrieve form data from Local Storage
        var infoFormData = JSON.parse(localStorage.getItem("infoFormData"));
        var interestFormData = JSON.parse(localStorage.getItem("interestFormData"));
        var writingFormData = JSON.parse(localStorage.getItem("writingFormData"));
        var reflectFormData = JSON.parse(localStorage.getItem("reflectFormData"));
        var availabilityFormData = JSON.parse(localStorage.getItem("availabilityFormData"));
        var finishFormData = JSON.parse(localStorage.getItem("finishFormData"));

        // Access Firestore database
        var db = firebase.firestore();

        // Create a new collection with a numbered ID
        db.collection((new Date()).getTime().toString()).doc().set({
          infoFormData: infoFormData,
          interestFormData: interestFormData,
          writingFormData: writingFormData,
          reflectFormData: reflectFormData,
          availabilityFormData: availabilityFormData,
          finishFormData: finishFormData
        })
          .then(function () {
            console.log("Form data saved to Firestore");
          })
          .catch(function (error) {
            console.error("Error saving form data: ", error);
          });

        // Clear Local Storage after saving data
        localStorage.clear();
      }

      // Function to save form data to Firestore
      function saveFormDataToFirestore() {
        // Retrieve form data from Local Storage
        var infoFormData = JSON.parse(localStorage.getItem("infoFormData"));
        var interestFormData = JSON.parse(localStorage.getItem("interestFormData"));
        var writingFormData = JSON.parse(localStorage.getItem("writingFormData"));
        var reflectFormData = JSON.parse(localStorage.getItem("reflectFormData"));
        var availabilityFormData = JSON.parse(localStorage.getItem("availabilityFormData"));
        var finishFormData = JSON.parse(localStorage.getItem("finishFormData"));

        // Access Firestore database
        var db = firebase.firestore();

        // Construct Firestore documents from form data
        if (infoFormData) {
          db.collection("formResponses").add(infoFormData)
            .then(function (docRef) {
              console.log("Info form data saved to Firestore with ID: ", docRef.id);
            })
            .catch(function (error) {
              console.error("Error saving info form data: ", error);
            });
        }

        if (interestFormData) {
          // Extract areas data
          var areas = [];
          if (interestFormData.areas) {
            areas = interestFormData.areas.map(function (area) {
              return {
                area: area.area,
                sliderValue: area.sliderValue,
                textareaValue: area.textareaValue
              };
            });
          }

          db.collection("formResponses").add({
            areas: areas,
            gpa: interestFormData.gpa,
            gp: interestFormData.gp
          })
            .then(function (docRef) {
              console.log("Interest form data saved to Firestore with ID: ", docRef.id);
            })
            .catch(function (error) {
              console.error("Error saving interest form data: ", error);
            });
        }

        if (writingFormData) {
          db.collection("formResponses").add(writingFormData)
            .then(function (docRef) {
              console.log("Writing form data saved to Firestore with ID: ", docRef.id);
            })
            .catch(function (error) {
              console.error("Error saving writing form data: ", error);
            });
        }

        if (reflectFormData) {
          db.collection("formResponses").add(reflectFormData)
            .then(function (docRef) {
              console.log("Reflect form data saved to Firestore with ID: ", docRef.id);
            })
            .catch(function (error) {
              console.error("Error saving reflect form data: ", error);
            });
        }

        if (availabilityFormData) {
          db.collection("formResponses").add(availabilityFormData)
            .then(function (docRef) {
              console.log("Availability form data saved to Firestore with ID: ", docRef.id);
            })
            .catch(function (error) {
              console.error("Error saving availability form data: ", error);
            });
        }

        if (finishFormData) {
          db.collection("formResponses").add(finishFormData)
            .then(function (docRef) {
              console.log("Finish form data saved to Firestore with ID: ", docRef.id);
            })
            .catch(function (error) {
              console.error("Error saving finish form data: ", error);
            });
        }
      }

      // Call renderAndAppendData() when the page loads
      document.addEventListener("DOMContentLoaded", function () {

      });

      document.getElementById("finishForm").addEventListener("submit", function (event) {
        saveFormData(); // Save form data to Local Storage
        event.preventDefault()
        renderAndAppendData();
        saveFormDataToFirestore();
        // Redirect or perform any other action after form submission
        window.location.href = "portal_submitted.html"; // Redirect to the next page
      });

    </script>

</body>
</html>